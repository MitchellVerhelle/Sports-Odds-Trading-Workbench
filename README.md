# Template Readme

### Plan

Sports-Odds Trading Workbench

Functional Specs
Data Ingestion
Load parquet files and possibly set up live-feed coroutine-driven WebSocket adapter for TheOddsApi sandbox
Column-schema discovery with CTRE compile-time regex to avoid run-time regex overhead.
Storage & Query
In-memory mdspacn views for hot data; possibly also SQLite snapshot writer for >10M rows, but will get to that if needed only.
Abstracted behind concept StorageBackend
Event bus
Lock-free single-producer-multi-consumer queue (using atomic_ref and circular_buffer). Publishes MarketEvent variant
Dispatch via std::visit (duck-typed variant pattern)
Strategy API
template<OddsEvent E> concept Strategy requires on_event(E const&) and flush()
Separate shared library so users can write their own strategy modules.
Backtest engine
Single-threaded deterministic replay; parallel Monte-Carlo “fork” path for variance estimation
Uses ranges pipelines for rolling-window stats; execution::par_unseq for inner loops.
Pricing & Risk
Constexpr Black-Scholes (+ SIMD acceleration with std::experimental::simd<double> or #pragma omp simd) and option greek calculators used in risk layer
Analytics
PnL, Sharpe, draw-down, Kelly fraction, cross-sportsbook arb finders, exports Arrow tables
Custom std::formatter for pretty CLI report.
Bindings & CLI
Pybind11 wheels (pip install oddsworkbench) + thin CLI (jthread for ^C).
Keep UI out of critical-path C++

Rubric map
Language & Library features
Modules
Each top-level layer above is a module (e.g., module odds.ingest;). Benefits: zero-cost header hygiene; fast rebuilds. Benefits: zero-cost header hygiene; fast rebuilds.
Concepts & constrained templates
concept strategy, concept StorageBackend, iterator constraints on CSV reader. Enables compile-time interface checks instead of runtime duck errors.
Ranges & views
loader returns std::ranges::subrange over records; compose sort | filter | transform | take pipelines like in lecture-13 demo.
Coroutines & std::generator
live-feed adapter yields MarketEvent stream; StopToken for shutdown
std::jthread + stop_token
one thread for (i) feed, (ii) strategy graph, (iii) risk report.
std::format & custom std::formatter
pretty PnL table; formatter demo matches lecture advice over ostream chains.
mdspan/SIMD
contiguous odds matrix; SIMD pricer overload selected by is_trivially_copyable and is_contiguous_iterator.
Compile-time regex (CTRE)
schema validator for CSV headers -> shows constexpr metaprogramming & avoids runtime back-tracking cost.
Variant + std::visit (“duck-typed polymorphism”)
MarketEvent holds OddsQuote, ScoreUpdate, etc.; visitor dispatch per lecture pattern.
Type-erasure wrapper
optional AnyStrategy erased class so Python users can hot-swap strategies without recompilation.
Rule of 0/5 & RAII
every handle (file, socket, thread) lives in an RAII wrapper; no naked new.
Spaceship operator <=>
defaulted on value types (OddsKey, Timestamp) for fast ordering.
const-correctness & mutable mutex
read-mostly catches guarded by shared_mutex; commentary in code about Kaitlyn’s proposal (const lock_shared).
Thread-safety invariants & lock ordering
macro-level documentation matches lecture-15 invariant pattern to avoid deadlocks.

Design principles / best practices
SRP/SOLID
Separate ingest, strategy, pricing, analytics modules. Interfaces separated (StorageBackend, Strategy)
Open/Closed
Users extend by adding new strategy DLLs without touching core
Visitor pattern vs variant
Code comment comparing both, shows when each is preferable
No using namespace std in headers
Enforced by clang-tidy config
Header include guards or #pragma once
Auto-generated by CMake templates
Type traits & SFINAE
Overload pick between SIMD and scalar pricer
Unit tests & property-based tests
Catch2; Athena test target with random-walk odds to verify martingale PnL ~0


Concurrency & performance

Lock-free queue
(atomic ring buffer) to decouple feeder and back-tester threads (lecture-14 memory-model content).
Execution policies
std::for_each(std::execution::par_unseq, …) inside pricing loop.
Custom allocator (if time permits)
Arena allocator for per-run objects to cut malloc churn.



Tooling

CI/Sanitizers / CppCheck
GitHub Actions matrix (clang 17 + gcc 14, ASAN/UBSAN)
Benchmarks
Google-bench micro-bench of pricer scalar vs SIMD
Documentation
Doxygen + mdbook “User Guide”
Packaging
CMake presets -> pip wheel via scikit-build-core


Next Steps
- [ ] Create repo skeleton (CMake modules, Catch2 test target, clang-format, CI badge).
- [ ] Pull first dataset (ATP CSV) and implement the ranges-based loaded (small but satisfying proof-of-concept).
